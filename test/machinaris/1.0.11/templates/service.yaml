{{ $svc := .Values }}
{{ $ports := list }}
{{ $ports = mustAppend $ports (dict "name" "pms" "port" $svc.machinaris_ui_port "nodePort" $svc.machinaris_ui_port "targetPort" "machinaris-ui") }}
{{ $params := . }}
{{ $_ := set $params "commonService" (dict "ports" $ports "type" "NodePort" ) }}
{{ include "common.classes.service" $params }}
---
{{ $this := . }}
{{ range $coin := $this.Values.coins }}
{{ $ports := list }}
{{ $_ := set $this "common" (dict "nameSuffix" $coin.name) }}
{{ range $port := $coin.ports }}
{{ $ports = mustAppend $ports (dict "name" (printf "%v-%v" $coin.name $port.containerPort) "port" $port.containerPort "targetPort" $port.containerPort) }}
{{ end }}
{{ $_ := set $this "commonService" (dict "ports" $ports "type" "ClusterIP" ) }}
{{ include "common.classes.service" $this }}
---
{{ $ports := list }}
{{ $_ := set $this "common" (dict "nameSuffix" $coin.name) }}
{{ $ports = mustAppend $ports (dict "name" $coin.name "port" $coin.apiPort.nodePort "nodePort" $coin.apiPort.nodePort "targetPort" $coin.apiPort.targetPort) }}
{{ $_ := set $this "commonService" (dict "ports" $ports "type" "NodePort" "nameSuffix" "api") }}
{{ include "common.classes.service" $this }}
---
{{ end }}
